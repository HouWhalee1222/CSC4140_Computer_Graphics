<!DOCTYPE html>
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>csc4140</title><meta http-equiv="Content-Language" content="en"><link rel="stylesheet" href="./Part4_files/ionicons.min.css">
<link rel="stylesheet" href="./Part4_files/web-5d805804.css">
<link rel="stylesheet" href="./Part4_files/katex.min.css">
<link rel="stylesheet" href="./Part4_files/github-markdown.css">
<link rel="stylesheet" href="./Part4_files/github.min.css"><style type="text/css">date-input-polyfill{background:#fff;color:#000;text-shadow:none;border:0;padding:0;height:auto;width:auto;line-height:normal;font-family:sans-serif;font-size:14px;position:absolute!important;text-align:center;box-shadow:0 3px 10px 1px rgba(0,0,0,.22);cursor:default;z-index:1;border-radius:5px;-moz-border-radius:5px;-webkit-border-radius:5px;overflow:hidden;display:block}date-input-polyfill[data-open=false]{visibility:hidden;z-index:-100!important;top:0}date-input-polyfill[data-open=true]{visibility:visible}date-input-polyfill select,date-input-polyfill table,date-input-polyfill td,date-input-polyfill th{background:#fff;color:#000;text-shadow:none;border:0;padding:0;height:auto;width:auto;line-height:normal;font-family:sans-serif;font-size:14px;box-shadow:none;font-family:Lato,Helvetica,Arial,sans-serif}date-input-polyfill button,date-input-polyfill select{border:0;border-radius:0;border-bottom:1px solid #dadfe1;height:24px;vertical-align:top;-webkit-appearance:none;-moz-appearance:none}date-input-polyfill .monthSelect-wrapper{width:55%;display:inline-block}date-input-polyfill .yearSelect-wrapper{width:25%;display:inline-block}date-input-polyfill select{width:100%}date-input-polyfill select:first-of-type{border-right:1px solid #dadfe1;border-radius:5px 0 0 0;-moz-border-radius:5px 0 0 0;-webkit-border-radius:5px 0 0 0}date-input-polyfill button{width:20%;background:#dadfe1;border-radius:0 5px 0 0;-moz-border-radius:0 5px 0 0;-webkit-border-radius:0 5px 0 0}date-input-polyfill button:hover{background:#eee}date-input-polyfill table{border-collapse:separate!important;border-radius:0 0 5px 5px;-moz-border-radius:0 0 5px 5px;-webkit-border-radius:0 0 5px 5px;overflow:hidden;max-width:280px;width:280px}date-input-polyfill td,date-input-polyfill th{width:32px;padding:4px;text-align:center;box-sizing:content-box}date-input-polyfill td[data-day]{cursor:pointer}date-input-polyfill td[data-day]:hover{background:#dadfe1}date-input-polyfill [data-selected]{font-weight:700;background:#d8eaf6}</style></head><body><script>$MG={"browserRefresh":false,"activeSemester":{"id":7,"tag":"sp22"},"auth":{"profile":null},"semester":{"id":7,"tag":"sp22"}}</script><div id="app-root"><div class="rel" id="app-page"><header class="rel" id="app-header"></header><div class="full" id="app-page__body"><div class="article"><div class="article-header"><h1>Assignment 7 Part 4</h1></div><div class="article-body"><div class="comp-md markdown-body"><p>
<img src="./Part4_files/eQE6bmn.png" width="90%">
</p>
<p><em>This image has a resolution of 1920x1080, and it was rendered with 256 samples/pixel, 4 samples/light, and max ray depth equal to 12. It takes about 25 minutes on a desktop using 8 threads</em></p>
<h2>Introduction</h2>
<p>In this part, you're going to simulate a thin lens to enable the depth of field effect.</p>
<p>Previously, we were using ideal pin-hole cameras. With the pin-hole model, everything is in focus. However, real cameras, including human eyes, are actually modeled as lenses with finite apertures defined by <code>lensRadius</code>. With the lens model, objects are in focus only if they're within a plane that is at <code>focalDistance</code> from the lens.</p>
<p>We're going to simulate lens in this part. To simplify your task, let's implement a <em>thin lens</em>, i.e. we ignore its actual thickness, but still assume that it refracts like a lens.</p>
<p>Once you've implemented this part, you can use the hotkeys <code>k</code> and <code>l</code> in the GUI to change the lens radius and <code>;</code> and <code>'</code> to change the focal distance. You can also set these parameters in the command line using <code>-b</code> and <code>-d</code> respectively. Setting lens radius to zero will reduce to the pinhole camera model you were using previously. Use the hotkey <code>d</code> and the command line flag <code>-c</code> to dump and load camera settings for doing command line rendering from different points of view and with different lens settings.</p>
<h2>Basic principles</h2>
<p>
<img src="./Part4_files/27_1.jpg">
</p>
<p>Let's first define the scene in camera space. We assume that the lens is located at position <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>z</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">z=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.04398em;">z</span><span class="mrel">=</span><span class="mord mathrm">0</span></span></span></span>, the plane of focus is at <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>z</mi><mo>=</mo><mo>−</mo><mrow><mi mathvariant="normal">f</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">D</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">e</mi></mrow></mrow><annotation encoding="application/x-tex">z=-\mathrm{focalDistance}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.04398em;">z</span><span class="mrel">=</span><span class="mord">−</span><span class="mord textstyle uncramped"><span class="mord mathrm" style="margin-right:0.07778em;">f</span><span class="mord mathrm">o</span><span class="mord mathrm">c</span><span class="mord mathrm">a</span><span class="mord mathrm">l</span><span class="mord mathrm">D</span><span class="mord mathrm">i</span><span class="mord mathrm">s</span><span class="mord mathrm">t</span><span class="mord mathrm">a</span><span class="mord mathrm">n</span><span class="mord mathrm">c</span><span class="mord mathrm">e</span></span></span></span></span>, and the image plane is at <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>z</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">z=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.04398em;">z</span><span class="mrel">=</span><span class="mord mathrm">1</span></span></span></span>.</p>
<p>In assignment 6 where there's no lens, we shoot a ray from <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">(0, 0, 0)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">(</span><span class="mord mathrm">0</span><span class="mpunct">,</span><span class="mord mathrm">0</span><span class="mpunct">,</span><span class="mord mathrm">0</span><span class="mclose">)</span></span></span></span> towards some direction <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><mi>X</mi><mo separator="true">,</mo><mi>Y</mi><mo separator="true">,</mo><mo>−</mo><mn>1</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">(X, Y, -1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.07847em;">X</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.22222em;">Y</span><span class="mpunct">,</span><span class="mord">−</span><span class="mord mathrm">1</span><span class="mclose">)</span></span></span></span> (red segment in the figure). This indicates that the point <code>pFilm</code> receiving radiance on the image plane should be <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><mo>−</mo><mi>X</mi><mo separator="true">,</mo><mo>−</mo><mi>Y</mi><mo separator="true">,</mo><mn>1</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">(-X, -Y, 1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">(</span><span class="mord">−</span><span class="mord mathit" style="margin-right:0.07847em;">X</span><span class="mpunct">,</span><span class="mord">−</span><span class="mord mathit" style="margin-right:0.22222em;">Y</span><span class="mpunct">,</span><span class="mord mathrm">1</span><span class="mclose">)</span></span></span></span>.</p>
<p>Now, with the thin lens, <code>pFilm</code> no longer receives radiance just from <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">(0, 0, 0)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">(</span><span class="mord mathrm">0</span><span class="mpunct">,</span><span class="mord mathrm">0</span><span class="mpunct">,</span><span class="mord mathrm">0</span><span class="mclose">)</span></span></span></span>. Instead, it is able to receive radiance from any point on the thin lens (yellow segment in the figure). So, we can uniformly sample the lens, which is a disk of radius <code>lensRadius</code>, to get the sampled point <code>pLens</code> on the lens at <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><msub><mi>s</mi><mi>x</mi></msub><mo separator="true">,</mo><msub><mi>s</mi><mi>y</mi></msub><mo separator="true">,</mo><mn>0</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">(s_x,s_y,0)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="base textstyle uncramped"><span class="mopen">(</span><span class="mord"><span class="mord mathit">s</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">x</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mpunct">,</span><span class="mord"><span class="mord mathit">s</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mpunct">,</span><span class="mord mathrm">0</span><span class="mclose">)</span></span></span></span>.</p>
<p>The next step is to calculate the direction of a ray from <code>pLens</code> towards the scene (blue segment in the figure). But how does the yellow segment refract through the thin lens? That can be complicated. However, we can take advantage of these two properties:</p>
<ol>
<li>
<p>Rays from the same point on the plane of focus will always be focused to the same point on the image plane, no matter where they pass through the lens.</p>
</li>
<li>
<p>The ray passing though the lens' center won't change direction.</p>
</li>
</ol>
<p>We can thus calculate just the intersection <code>pFocus</code> of the red segment and the plane of focus. We then immediately know that the blue segment must go through <code>pFocus</code> as well.</p>
<p>The blue ray is what we will generate in this task. Compared to the red ray for pin-hole cameras, its origin is no longer <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">(0, 0, 0)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">(</span><span class="mord mathrm">0</span><span class="mpunct">,</span><span class="mord mathrm">0</span><span class="mpunct">,</span><span class="mord mathrm">0</span><span class="mclose">)</span></span></span></span> but randomly sampled. Its direction also varies but is decided once its origin is sampled.</p>
<h2>Task 0: Refactoring assignment 6 Code</h2>
<p>In order to enable depth of field effects, you'll need to change the ray-generating function called by <code>PathTracer::raytrace_pixel()</code>.</p>
<p><strong>If you're using your code from assignment 6</strong>, replace the <code>generate_ray()</code> function in <code>PathTracer::raytrace_pixel()</code> with your <code>generate_ray_for_thin_lens()</code> function. You can use <code>gridSampler-&gt;get_sample()</code> to generate two random values in the range <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">[0, 1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">[</span><span class="mord mathrm">0</span><span class="mpunct">,</span><span class="mord mathrm">1</span><span class="mclose">)</span></span></span></span>, and multiply one of them by <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>2</mn><mi>π</mi></mrow><annotation encoding="application/x-tex">2\pi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">2</span><span class="mord mathit" style="margin-right:0.03588em;">π</span></span></span></span> to get your inputs for <code>rndR</code> and <code>rndTheta</code> (the other inputs are the same as before).</p>
<pre><code class="language-cpp">Vector2D samplesForLens = gridSampler-&gt;get_sample();
r = camera-&gt;generate_ray_for_thin_lens(<span class="hljs-comment">/*same*/</span>, <span class="hljs-comment">/*same*/</span>, samplesForLens.x, samplesForLens.y * <span class="hljs-number">2.0</span> * PI);
</code></pre>
<p><strong>If you're using the staff library</strong>, you can enable the thin lens by setting the aperture to anything other than 0. This will tell <code>raytrace_tile()</code> to call your precompiled <code>generate_ray_for_thin_lens()</code> function with the proper inputs.</p>
<h2>Task 1: Generating Rays for a Thin Lens</h2>
<p>In this task, you're required to implement the <code>Camera::generate_ray_for_thin_lens()</code> function. This function takes the same parameters <code>x</code> and <code>y</code> as in <code>Camera::generate_ray()</code>, but also receives two additional parameters <code>rndR</code> and <code>rndTheta</code> that are random numbers uniformly distributed in <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">[0, 1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">[</span><span class="mord mathrm">0</span><span class="mpunct">,</span><span class="mord mathrm">1</span><span class="mclose">)</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>[</mo><mn>0</mn><mo separator="true">,</mo><mn>2</mn><mi>π</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">[0, 2\pi)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">[</span><span class="mord mathrm">0</span><span class="mpunct">,</span><span class="mord mathrm">2</span><span class="mord mathit" style="margin-right:0.03588em;">π</span><span class="mclose">)</span></span></span></span> respectively. They are used to uniformly sample the thin lens.</p>
<p>Specifically, your can follow these steps:</p>
<ul>
<li>Look up your code from assignment 6, Part 1 to figure out the generated ray direction (red segment in the figure).</li>
<li>Uniformly sample the disk representing the thin lens at <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mi mathvariant="normal">p</mi><mi mathvariant="normal">L</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi></mrow><mo>=</mo><mo>(</mo><mrow><mi mathvariant="normal">l</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">R</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">d</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">s</mi></mrow><mtext>&nbsp;</mtext><msqrt><mrow><mi>r</mi><mi>n</mi><mi>d</mi><mi>R</mi></mrow></msqrt><mo>⋅</mo><mi>cos</mi><mo>(</mo><mrow><mi mathvariant="normal">r</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">d</mi><mi mathvariant="normal">T</mi><mi mathvariant="normal">h</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">a</mi></mrow><mo>)</mo><mo separator="true">,</mo><mrow><mi mathvariant="normal">l</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">R</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">d</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">s</mi></mrow><mtext>&nbsp;</mtext><msqrt><mrow><mi>r</mi><mi>n</mi><mi>d</mi><mi>R</mi></mrow></msqrt><mo>⋅</mo><mi>sin</mi><mo>(</mo><mrow><mi mathvariant="normal">r</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">d</mi><mi mathvariant="normal">T</mi><mi mathvariant="normal">h</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">a</mi></mrow><mo>)</mo><mo separator="true">,</mo><mn>0</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathrm{pLens}=(\mathrm{lensRadius}\ \sqrt{rndR} \cdot \cos(\mathrm{rndTheta}), \mathrm{lensRadius}\ \sqrt{rndR} \cdot \sin(\mathrm{rndTheta}), 0)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.93222em;"></span><span class="strut bottom" style="height:1.18222em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord textstyle uncramped"><span class="mord mathrm">p</span><span class="mord mathrm">L</span><span class="mord mathrm">e</span><span class="mord mathrm">n</span><span class="mord mathrm">s</span></span><span class="mrel">=</span><span class="mopen">(</span><span class="mord textstyle uncramped"><span class="mord mathrm">l</span><span class="mord mathrm">e</span><span class="mord mathrm">n</span><span class="mord mathrm">s</span><span class="mord mathrm">R</span><span class="mord mathrm">a</span><span class="mord mathrm">d</span><span class="mord mathrm">i</span><span class="mord mathrm">u</span><span class="mord mathrm">s</span></span><span class="mord mspace">&nbsp;</span><span class="sqrt mord"><span class="sqrt-sign" style="top:-0.09221999999999997em;"><span class="style-wrap reset-textstyle textstyle uncramped">√</span></span><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span><span class="mord textstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">n</span><span class="mord mathit">d</span><span class="mord mathit" style="margin-right:0.00773em;">R</span></span></span><span style="top:-0.85222em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span><span class="reset-textstyle textstyle uncramped sqrt-line"></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span>​</span></span></span><span class="mbin">⋅</span><span class="mop">cos</span><span class="mopen">(</span><span class="mord textstyle uncramped"><span class="mord mathrm">r</span><span class="mord mathrm">n</span><span class="mord mathrm">d</span><span class="mord mathrm">T</span><span class="mord mathrm">h</span><span class="mord mathrm">e</span><span class="mord mathrm">t</span><span class="mord mathrm">a</span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mord textstyle uncramped"><span class="mord mathrm">l</span><span class="mord mathrm">e</span><span class="mord mathrm">n</span><span class="mord mathrm">s</span><span class="mord mathrm">R</span><span class="mord mathrm">a</span><span class="mord mathrm">d</span><span class="mord mathrm">i</span><span class="mord mathrm">u</span><span class="mord mathrm">s</span></span><span class="mord mspace">&nbsp;</span><span class="sqrt mord"><span class="sqrt-sign" style="top:-0.09221999999999997em;"><span class="style-wrap reset-textstyle textstyle uncramped">√</span></span><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span><span class="mord textstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">n</span><span class="mord mathit">d</span><span class="mord mathit" style="margin-right:0.00773em;">R</span></span></span><span style="top:-0.85222em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span><span class="reset-textstyle textstyle uncramped sqrt-line"></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span>​</span></span></span><span class="mbin">⋅</span><span class="mop">sin</span><span class="mopen">(</span><span class="mord textstyle uncramped"><span class="mord mathrm">r</span><span class="mord mathrm">n</span><span class="mord mathrm">d</span><span class="mord mathrm">T</span><span class="mord mathrm">h</span><span class="mord mathrm">e</span><span class="mord mathrm">t</span><span class="mord mathrm">a</span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mord mathrm">0</span><span class="mclose">)</span></span></span></span>.</li>
<li>Calculate <code>pFocus</code> by intersecting the plane of focus with the red segment.</li>
<li>Calculate the ray that originates from <code>pLens</code>, and set its direction towards <code>pFocus</code> (blue segment in the figure).</li>
<li>Normalize the direction of the ray, perform the camera-to-world conversion for both its origin and direction, add <code>pos</code> to the ray's origin, and set the near and far clips to be the same as in assignment 6, Part 1.</li>
</ul>
</div></div></div></div><footer id="app-footer"></footer></div></div>
<script>$_mod_cal184.ready();</script><date-input-polyfill data-open="false"><span class="yearSelect-wrapper"><select class="yearSelect"><option value="1890">1890</option><option value="1891">1891</option><option value="1892">1892</option><option value="1893">1893</option><option value="1894">1894</option><option value="1895">1895</option><option value="1896">1896</option><option value="1897">1897</option><option value="1898">1898</option><option value="1899">1899</option><option value="1900">1900</option><option value="1901">1901</option><option value="1902">1902</option><option value="1903">1903</option><option value="1904">1904</option><option value="1905">1905</option><option value="1906">1906</option><option value="1907">1907</option><option value="1908">1908</option><option value="1909">1909</option><option value="1910">1910</option><option value="1911">1911</option><option value="1912">1912</option><option value="1913">1913</option><option value="1914">1914</option><option value="1915">1915</option><option value="1916">1916</option><option value="1917">1917</option><option value="1918">1918</option><option value="1919">1919</option><option value="1920">1920</option><option value="1921">1921</option><option value="1922">1922</option><option value="1923">1923</option><option value="1924">1924</option><option value="1925">1925</option><option value="1926">1926</option><option value="1927">1927</option><option value="1928">1928</option><option value="1929">1929</option><option value="1930">1930</option><option value="1931">1931</option><option value="1932">1932</option><option value="1933">1933</option><option value="1934">1934</option><option value="1935">1935</option><option value="1936">1936</option><option value="1937">1937</option><option value="1938">1938</option><option value="1939">1939</option><option value="1940">1940</option><option value="1941">1941</option><option value="1942">1942</option><option value="1943">1943</option><option value="1944">1944</option><option value="1945">1945</option><option value="1946">1946</option><option value="1947">1947</option><option value="1948">1948</option><option value="1949">1949</option><option value="1950">1950</option><option value="1951">1951</option><option value="1952">1952</option><option value="1953">1953</option><option value="1954">1954</option><option value="1955">1955</option><option value="1956">1956</option><option value="1957">1957</option><option value="1958">1958</option><option value="1959">1959</option><option value="1960">1960</option><option value="1961">1961</option><option value="1962">1962</option><option value="1963">1963</option><option value="1964">1964</option><option value="1965">1965</option><option value="1966">1966</option><option value="1967">1967</option><option value="1968">1968</option><option value="1969">1969</option><option value="1970">1970</option><option value="1971">1971</option><option value="1972">1972</option><option value="1973">1973</option><option value="1974">1974</option><option value="1975">1975</option><option value="1976">1976</option><option value="1977">1977</option><option value="1978">1978</option><option value="1979">1979</option><option value="1980">1980</option><option value="1981">1981</option><option value="1982">1982</option><option value="1983">1983</option><option value="1984">1984</option><option value="1985">1985</option><option value="1986">1986</option><option value="1987">1987</option><option value="1988">1988</option><option value="1989">1989</option><option value="1990">1990</option><option value="1991">1991</option><option value="1992">1992</option><option value="1993">1993</option><option value="1994">1994</option><option value="1995">1995</option><option value="1996">1996</option><option value="1997">1997</option><option value="1998">1998</option><option value="1999">1999</option><option value="2000">2000</option><option value="2001">2001</option><option value="2002">2002</option><option value="2003">2003</option><option value="2004">2004</option><option value="2005">2005</option><option value="2006">2006</option><option value="2007">2007</option><option value="2008">2008</option><option value="2009">2009</option><option value="2010">2010</option><option value="2011">2011</option><option value="2012">2012</option><option value="2013">2013</option><option value="2014">2014</option><option value="2015">2015</option><option value="2016">2016</option><option value="2017">2017</option><option value="2018">2018</option><option value="2019">2019</option><option value="2020">2020</option><option value="2021">2021</option><option value="2022">2022</option><option value="2023">2023</option><option value="2024">2024</option><option value="2025">2025</option><option value="2026">2026</option><option value="2027">2027</option><option value="2028">2028</option><option value="2029">2029</option><option value="2030">2030</option><option value="2031">2031</option><option value="2032">2032</option><option value="2033">2033</option><option value="2034">2034</option><option value="2035">2035</option><option value="2036">2036</option><option value="2037">2037</option><option value="2038">2038</option><option value="2039">2039</option><option value="2040">2040</option><option value="2041">2041</option><option value="2042">2042</option></select></span><span class="monthSelect-wrapper"><select class="monthSelect"></select></span><button>Today</button><table><thead></thead><tbody></tbody></table></date-input-polyfill></body></html>